# 如何进行安全测试  <!-- {docsify-ignore} -->
## 1.输入处理

由 http 请求传入的信息，需要在业务逻辑处理之前进行数据处理。

对策：

转换字符编码、输入校验（校验所有的参数，单选框、cookie 值等）

## 2.页面显示

跨站脚本（cross-site scripting,Xss)在生成 HTML 和 JS 的地方。分为反射型和存储型。

有几种方式：其中 script 元素的 XSS

```jsx
<script>alert(document.cookie)</script>
<Script>alert(document.cookie)</Script> //大小写
xx.com/xx.php?Parameter=<img src="" onerror=alert(1)>//事件处理器或者 <body onload=alert(1)>
<script>alert(\"xss\")</script>//xss 字符用"\"
<input id="ss" value="" type="text"><script>alert(1)</script>//标签闭合
```

对策：

1.属性值用双引号括起，并转义< 和 “ 和&

2.检查链接的目标 url，如果指向外部网站就报错或者显示页面提醒用户可能存在风险

3.将数据作为 js 字符串字面量进行转义，将得到的结果再次进行 html 转义

扫描工具:web Scanner 、BurpSuite

## 3. SQL 调用

sql 注入漏洞是由于 sql 语句的调用方法不完善而产生的安全隐患。不需要用户参与。

有几种方式：字符串字面量的问题、针对数值的 sql 注入攻击

对策：

使用占位符拼接 SQL 语句

不显示详细的错误消息

检验输入值的有效性

设置数据库权限（当只有读权限时，就不授予写的权限）

将字符串字面量中有特殊意义的字符和符号进行转义

## 4. 跨站请求伪造

跨站请求伪造（CSRF）用户点击恶意连接、浏览恶意网站等。

有几种方式：输入-执行

对策：

- 筛选出需要防范 CSRF 攻击的页面（如购买、更改页面）
- 在执行处理前确认请求是由用户自愿发起的（请求中 referer 字段）

辅助性对策：执行完关键处理后，向用户注册的邮箱发送通知邮件

## 5.重定向

有几种方式：自由重定向漏洞、http 消息头注入

对策：（自由重定向漏洞）

- 固定重定向的目标 url
- 使用警告页面，在允许重定向至外部网站的情况下，插入警告页面来防止钓鱼式攻击。警告页面还能防止会话 ID 泄漏，因此在面向手机中也有着广泛的应用

http 消息头

重定向或生成 cookie 等基于外部传入的参数而输出 http 响应头的地方。消息头之间互相以换行符相隔

对策：（http 消息头）

- 不将外界传入的参数作为 http 响应消息头输出
- 由专门的 API 来进行重定向或生成 cookie 的处理
- 校验生成的消息头的参数中的换行符。将 cookie 中的换行符进行百分百编码；

## 6.cookie 输出

方式：cookie 的用途不当、cookie 的输出方法不当

用户可以自己修改 cookie 值，对于用户无法修改的数据不能存放在 cookie 中。

对策：

- 设置 cookie 的安全属性,httponly，Secure
- 使用令牌，防止会话劫持

## 7.发送邮件

方式：使用 hidden 参数保存收件人信息、邮件头注入漏洞

对策：

- 使用专门的程序来发送邮件
- 不将外界传入的参数包含在邮件头中
- 发送邮件时确保外界传入的参数中不包含换行符

邮件头注入的辅助性对策

- 校验邮箱地址
- 校验标题

## 8.文件处理
### 目录遍历漏洞

对策：

- 避免由外界指定文件名
- 文件名不允许包含目录名
- 限定文件名中仅包含字母和数字

### 文件上传

方式：上传体积巨大的文件、上传的文件在服务器上作为脚本执行

对策：限制上传文件的容量、不将用户上传的文件保存在公开目录中，浏览文件需通过脚本

### 文件下载

方式：上传嵌入 html 或 js 的图像文件或 pdf 文件（内容存放 js 脚本）

对策：

- 正确设置文件的 content-type
- 确保图像文件的扩展名与内容（图像文件头）相符
- 判定为用于下载的文件时，在响应头中指定 content-disposition:attachment