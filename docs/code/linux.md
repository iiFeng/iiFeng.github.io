# Linux 归纳 <!-- {docsify-ignore} -->
本文由《鸟哥的 Linux 私房菜》进行信息归纳，通过结构化的模块划分，我将全部知识点划分为 5 大模块，先了解整体知识再根据所需了解细节部分，阅读全文可了解 Linux 的基础知识要点。当然更多是使用起来。

![](_media/linux.png)

## 操作系统
操作系统（Operating System，OS）是软件的一部分，它是硬件基础上的第一层软件，是硬件和其它软件沟通的桥梁（或者说接口、中间人、中介等）。  

操作系统的内核用来管理电脑的所有活动以及驱动系统中的所有硬件。操作系统还提供一套 API 让程序员进行开发软件，进行系统调用。       

操作系统就好像是一个政府，其它软件都会被它管控；操作系统在给其他软件提供各种便利的同时，还会约束其他软件不能为所欲为。      
### 电脑硬件
硬件组成部分分为五大单元：输入单元，输出单元，主机部分的 CPU 内部的控制单元、算术逻辑单元，内存。

电脑运作流程：CPU、内存、硬盘、主板、显卡、主机电源、接口设备,将其比做一个人体:

-  CPU、内存、硬盘为脑袋。CPU 为脑袋控制身体，内存为脑袋中正在被思考的数据的区块（暂时存放），硬盘为脑袋中存放回忆的记忆区块（记录数据）
- 主板为人的神经，连接各个组件，通过神经传导给手脚来进行活动
- 显卡为脑袋中的影像，显卡所产生的数据源也由 CPU 控制
- 主机电源为心脏，所有的组件需要足够的电力供给才能运行
- 接口设备为手、脚、皮肤等，是人体与外界互动的重要关键

## 文件系统管理
Linux 内的所有数据都是以文件的形式来呈现，文件数据放置在磁盘分区中（硬盘分区为磁盘）。
目录树结构，所有文件都是由跟目录（/）衍生出来的。

目录树的架构与磁盘内的数据通过挂载进行结合。将磁盘分区的数据放在该目录下，进入某个目录即可读取该分区的数据。挂载点一定是目录，该目录为进入文件系统的入口。

所有的数据要加载到内存后 CPU 才能够进行处理。当系统加载一个文件到内存后，内存区中的文件没有被修改过则该文件数据被设置为干净 clean。如果内存中的文件数据被更改过了则设置为 Dirty，此时所有的操作还在内存中执行还没写入到磁盘中，系统会不定时（异步处理）的将内存中的 Dirty 数据写回磁盘，以保持磁盘与内存数据的一致性。
#### 文件磁盘管理：    
- df 查看磁盘的容量   
- du 查看目录大小，查看目录占空间大小：du -sh

### 文件与目录权限
文件可读写身份分为三个类别：拥有者(owner)、所属群组(group)、其他人(other)

#### 文件属性    
如：-rwxrw-r-- 1 user user 0 Nov 28 11:18 aa.txt   

    -代表这个文件是目录、文件或链接文件等（d,-,l)      
    rwx 表示：read 可读、write可写、execute 可执行      
    第一个 rwx 为文件拥有者可具备的权限     
    第二组 rw- 为加入此用户组之账号的权限       
    第三组 r-- 为非本人且没有加入本用户组的其他账号的权限    
    有多少文件名链接到此节点        
    这个文件（或目录）的拥有者账号      
    这个文件所属用户组      
    这个文件的容量大小      
    这个文件的创建时间或修改时间        
#### 修改文件属性      
- chgrp：修改文件所属用户组       
- chown：修改文件拥有者       
- chmod：修改文件权限，通过符号类型修改权限，共有三种身份，3 种读写权限，a 表示 all 全部的身份，如：chmod a+x fileName 表示所有的身份都可以执行 fileName 文件     

### 文件与目录内容查看
#### 目录的相关操作
绝对路径：由根目录（/）开始写起对文件名或目录名称，如：cd /usr/bin      
相对路径：相对于目前路径对文件名写法，如：./home 或者 ../../home/dmtsai/        
- . 或 ./ 代表当前的目录      
- .. 或 ../ 代表上一层目录        
- -//代表前一个工作目录，刚刚那个目录。cd -       
- ～ //代表目前使用者身份所在的家目录     
- cd //切换目录 change directory      
- pwd //显示当前目录 print working directory      
- mkdir //建立一个新目录      
- rmdir //删除一个空目录      

#### 复制、删除与移动和重命名文件
- cp 复制文件，cp [源文件] [目标文件]，远端机器复制：scp -p 1234 remote@127.0.01:文件目录 本地目录
- rm 删除文件或文件夹，-r 递归删除，-f 强制，rm -r xx
- mv 移动文件，mv [源文件] [目标文件]
- mv 重命名，mv [source 文件名] [修改后的文件名 destination]

#### 文件内容查看
- ls 列出目录中的文件，ls -a 列出目录中所有的文件，包括隐藏文件     
- cat -n fileName，打印出行号
- more fileName，可翻页查看
- less fileName，翻页查看，还有更多查找功能     
    / 向下查找字符串的功能      
    ? 向上查找字符串的功能      
    g 前进到这个数据的第一行        
    G 前进到这个数据的最后一行去        
    q 离开 less 这个程序        
- head、tail 数据截取       
head 取出前面几行，-n 表示显示几行的意思。打印出一个文件的第500-1000行：head -n 1000 file |tail -n 500      
tail 取出后面几行，查看后500条日志：tail -n 500 log   

#### 文件查找
- find      
与时间有关的查找，find / -mtime 0 //查找过去系统 24 小时内有修改内容的文件      
与文件权限和名称的查找，find .  -name '*.httpd' //查找当前目录下文件名包含 httpd 的文件     
查找指定文件类型的文件，find /run -type s //查找 /run 目录下文件类型为 socket 的文件        
将查找的文件进行额外命令处理，find . -type f -exec rm -rf {} \；递归删除一个目录下的所有文件,{}  代表由 find 找到内容，-exec  到 \； 为 find 的额外操作，因为 ; 在 bash 具有特殊意义所以利用反斜杠来转义      

### 文件与文件系统的压缩
#### 压缩、解压单个文件
- gzip fileName
- gzip -d fileName

#### 打包：压缩多个文件
- tar，参数：-c 创建打包文件，-t 查看打包文件名，-x 解包或解压缩功能，-j 通过 bzip2 的支持进行压缩/解压缩，-v 在解压或压缩的过程中，将正在处理的文件名显示出来       
tar -cjv -f filename.tar.bz2 被压缩的文件或目录名称

## shell
### vim 文本编辑器
三种模式：一般命令模式、编辑模式、命令行模式
1. 一般命令模式        
移动光标的方法：  
    ctrl +f 屏幕向下移动一页        
    ctrl +b 屏幕向上移动一页        
    0 //移动到这一行到最前面的字符处        
    $ //移动到这一行到最后字符处        
    G //移动到这个文件的最后一行        
    nG //移动到这个文件的第 n 行。20G 则是移动到这个文件的第 20 行      
    gg // 移动到这个文件的第一行，相当于 1G     
    n<enter> //n 为数字，光标向下移动 n 行      
    59 ->右箭头 //向右移动 59 个字符             

    删除、复制与粘贴：      
    x 向后删除一个字符串        
    X 为向前删除一个字符串      
    dd //删除整行       
    yy //复制光标所在行，如复制 66 到 71 行这 6 行，6yy 复制 6 行       
    u //恢复前一个操作      
    . //重复前一个操作，如重复删除，重复黏贴等          

2. 编辑模式     
    i //光标所在处插入
    esc //退出编辑模式，回到一般命令模式

3. 命令行模式       
替换与查找      
/word //向光标之下查找名称为 word 的字符串      
?word //向光标之上查找      

    保存、退出      
    :w //写入       
    :w [filename] //将编辑的数据保存成另一个文件（另存新文件）      
    :q //退出       
    :wq //保存后退出        

### bash
通过 bash 命令，与内核进行沟通，管理 linux 系统。

#### 变量
设置变量，变量与变量内容以一个等号【=】来连接，【\】转义特殊字符，如结束命令：\;如 export $name="vbrid's $name"             
环境变量的功能：可用于执行文件查找的路径等
env 、set 可查看 shell 环境的所有环境变量       
变量的有效范围：环境变量=全局变量，自定义变量=局部变量

#### bash 的操作环境 
bash 的环境配置文件：~/.bash_profile 或 ~/.bash_login 或～/.profile 属于用户个人设置        
读入环境配置文件的命令：source 配置文件文件名，如 source ~/.bash_profile  

#### 通配符
* 表示 0 到无穷多个任意字符，？ 表示一定有一个任意字符，[]表示一定有一个在括号内，[ x-x] 表示在编码顺序内的所有字符，[^] 反向选择       
ll -d /etc/cron* //找出 etc 下面以 cron 为开头的文件名      
[^abc] 一定有一个字符不是a、b、c 的其他字符   

#### 管道命令（pipe）
｜，处理经由前面一个命令传来的正确信息
1. 选取命令：cut，grep
- cut 将同一行里的数据进行分解，-d 分隔字符，-f 取出第几段的意思。如：echo ${PATH} | cut -d ':' -f 3,5。列出第 3 与第 5       
- grep 分析一行信息，将所需信息的整行为单位来进行数据的截取，grep [-acinv] ‘查找字符’ filename      
grep --color=auto 'MANPATH' fileName，查看某文件里含有 MANPATH 的那几行     
grep -n ‘查找字符’ filename，查找特定字符串，将查找到的数据和对应行号输出       
grep  't[ae]st' filename，利用中括号[]来查找集合字符，查找 tast 或 test 这两个关键词        
grep -r update /etc/acpi  以递归的方式查找符合条件的文件,且文件中包含字符串"update"的文件       
2. 排序命令：sort、wc
- sort 排序，cat /etc/passwd |sort ，将数据进行排序
- wc 输出信息的整体数据，-l 列出行，-w 列出多少字，wc -l //统计行数
3. 参数代换：xargs
给命令传递参数的一个过滤器，xargs 可以将管道或标准输入（stdin）数据转换成命令行参数，也能够从文件的输出中读取数据。很多命令不支持管道来传递参数，如：找出 /usr/sbin 下面具有特殊权限的文件名，并使用 ls -l 列出详细属性。find /usr/sbin -perm /7000 ｜ xargs ls -l
4. sed
管道命令，分析标准输入 sed，用于过滤和转换文本的编辑器，行为单位的新增或删除、替换      
- nl /etc/passwd | sed '2,5d' //在 2-5 行删除     
- sed 's/要被取代的字符串/新的字符串/g' //数据的搜索并替换 /g     
5. awk
处理一个整行，将一行当中分成数个字段来处理      
- awk '{}' 设置想要对数据进行的处理操作，如：last -n 5 | awk '{print $1 "\t" $3}'，通过 print 的功能将字段数据列出来，每一行的每个字段都是有变量名称

### shell 脚本
shell 脚本是根据 shell 所写的剧本。用于自动化管理和跟踪系统状态。
1. 执行脚本：       
sh xx.sh 直接执行（只在子进程中生效），sh -n xx.sh //不执行，检查语法问题       
source xx.sh （在父进程 bash 生效）     
./xx.sh  相对路径执行       
2. 编写脚本         
第一行：#!/bin/bash 声明这个文件内使用 bash 的语法来执行        
执行命令 var=$( (运算内容) )，$[]，$(()) //一样 进行数学运算的      
${ } 用于变量替换       
$() 用于做命令替换。$(whoami)、$(pwd)       
判断符号[]，[ "$home" == "$small" ]//判断字符串是否相等     
循环：while do done，for...do...done（固定循环），until do done (不固定循环)      

## 系统管理
### 账号管理
- 账号      
新增账号：useradd xx        
删除账号：userdel [-r] username //-r 连同使用者的家目录一起删除     
禁用账号密码登录：passwd -l xx，passwd -u xx //-l 表示 lock 禁用密码，-u 表示 unlock        
- 用户组        
新增用户组：groupadd [-r] 用户组名称//-r 建立系统用户组     
修改用户组：groupmod [-n group_name] 用户组名       
删除用户组：groupdel [groupname]        

### 进程管理
进程：触发任何一个事件，系统都会将它定义成一个进程，并给予一个进程 ID，称为 PID。并根据触发这个进程的用户与相关属性关系，给予有效的权限设置。
- ps aux //查看系统所有进程     
ps aux | grep 'mysql' //查找某个进程号      
ps -ef //-e 所有当进程均显示出来，f 做一个更为完整的输出        
ps -l //查看自己的 bash 相关进程        
lsof “list opened files”，根据文件找到对应的进程信息，也可以根据进程信息找到进程打开的文件。        

#### 任务管理
在单一终端下同时执行多个任务的操作管理，可在前台，后台执行。
- jobs //查看目前的后台任务状态
- kill 管理后台当中的任务，kill -9 pid //强制删除一个任务，-9 为信号的代号，中断一个进程

### 资源管理
- free //查看内存使用情况
- netstat 追踪网络或 socket 文件，输出部分有网络和系统进程相关部分           
netstat -tunlp //查看目前系统上已在监听的网络连接及 PID，-t 指 tcp,-u 指 udp, -n 以端口号显示，-l 正在网络监听的服务，-p 网络服务的进程 PID     
netstat -tunpl | grep 端口号，查看指定端口进程
- dmesg 分析内核产生的信息（不管是启动还是系统运行过程中，内核会去检查系统的硬件）      
dmesg | grep -i vda //查找启动的时候，硬盘的相关信息是什么
- vmstat 检测系统资源变化

### 日志管理
日志文件：记录系统活动信息的几个文件，记录系统在什么时候有哪个进程做了什么样的操作时，发生来何种事件。      
/var/log/messages 记录系统发生错误信息，还有其他方面的日志，如 定时、登录等     
对日志文件进行备份与更新，通过 logtotate 日志文件轮循，将就旧文件改名，创建一个空的日志文件。  

### 备份与恢复
累计备份        
系统在进行完第一次完整备份后，经过一段时间的运行，比较系统与备份文件之间的差异，仅备份有差异的文件。还原需要根据结合前面的所有备份。        
差异备份        
每次备份都是与原始的完整备份比较的结果。还原完整备份只需与最近一次的差异备份。     
 
## 软件管理器
DPKG：dpkg，使用命令：apt-get       
RPM：RedHat Package Manager，使用命令：yum