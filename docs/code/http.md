# HTTP  <!-- {docsify-ignore} -->
本文由《图解 HTTP》进行信息归纳，可了解 HTTP 协议的要点。
## TCP/IP 协议族

不同的硬件、操作系统之间的通信，定义的通信的规则称为协议。

## TCP/IP 通信传输流

如在浏览器访问某个页面。

大的粒度上会经过 应用层—》传输层—》 网络层—》链路层

细节上是：浏览器先在浏览器缓存里查看是否有缓存，如果没有查看本地浏览器是否有缓存，如果没有则请求地址通过 DNS 协议解析为 ip 地址，HTTP 协议生成 HTTP 请求报文，转发到 TCP 协议，进行三次握手将报文分割为报文段可靠地转发给 IP 协议，通过路由器网关找到服务器的 MAC 地址，将报文转发到链路层进行数据传输给服务器端的链路层，将收到报文转发到 TCP 协议进行重组请求报文，转发到 HTTP 协议对服务器请求的内容进行处理，将请求结果也同样利用 TCP/IP 通信协议向用户进行回传。

## HTTP 协议

用于客户端和服务端之间的通信，通过请求和响应交换达成通信。

请求报文由：请求方法、请求 URL、协议版本、可选的请求首部字段和内容实体。

HTTP 是无状态协议，使用 Cookie 的状态管理。

### Cookie 的状态管理

Cookie 技术通过在请求和响应报文中写入 Cookie 信息来控制客户端的状态。

客户端发送请求，服务器在响应消息添加 Cookie 返回给客户端，下一次客户端再往服务器发送请求会自动在请求报文中加入 Cookie 值后再送出去。服务器发送客户端发送 cookie 后会去检查是从哪个客户端发送的连接请求，然后对比服务器上的记录，最后得到之前的状态信息。

### HTTP 方法，告诉服务器意图

GET 获取资源：请求访问资源，获取响应的主体内容，经服务器解析后返回响应内容。

POST 传输实体主体：表单提交。

PUT 传输文件：Web 网站用 REST（表征状态转移）进行 PUT 方法

HEAD 获得报文首部：不返回报文主体部分

DELETE 删除文件：按请求 URI 删除指定的资源

OPTIONS 询问支持的方法：用来查询针对请求 URI 指定的资源支持的方法

TRACE 追踪路径：让 web 服务器端将之前的请求通信返回给客户端的方法

### HTTP 报文

HTTP 报文：用于 HTTP 协议交互的信息。客户端的 HTTP 报文叫做请求报文，响应端叫做响应报文。

请求报文、响应报文：分为报文首部、空行、报文主体

请求报文首部分为：请求行、请求首部字段、通用首部字段、实体首部字段、其他

响应报文首部分为：状态行、响应首部字段、通用首部字段、实体首部字段、其他

### 通用首部字段

Cache-Control 控制缓存的行为，指令 no-cache 强制向源服务器再次验证，为了防止从缓存中返回过期的资源。客户端发送的请求带有 no-cache 指令，表示客户端将不会接收缓存过的响应。服务器返回的响应也带有 no-cache 指令，那么缓存服务器不能对资源进行缓存。

### 请求首部字段

Accept 用户代理可处理的媒体类型

Accept-Encoding 优先的内容编码

Authorization Web 认证信息

Referer 请求地址原始方

Host 请求资源所在服务器

### 响应首部字段

Accept-Ranges 是否接受字节范围请求

Content-Type：实体主体内对象的媒体类型

### 返回结果的 HTTP 状态码

1xx 信息性状态码：接收的请求正在处理

2xx 成功状态码：请求正常处理

3xx 重定向状态码：需要进行附加操作以完成请求

4xx 客户端错误状态码：服务器无法处理请求

5xx 服务器错误状态吗：服务器处理请求出错

- 详细状态码

200 OK 表示客户端发来的请求在服务器被正常处理

204 No Content 表示请求处理成功，没有更新的资源返回

206 Partial Content 表示客户端只进行部分请求，响应报文中包含 Content-Range 指定范围的实体内容

301 Moved Permanently 表示永久性重定向。表示请求的资源已被分配了新的 URI

302 Found 表示临时性重定向。表示请求的资源已被分配了新的 URL，用户下次能使用新的 URI 访问

303 See Other 表示由于请求对应的资源存在着另一个 URI，应使用 GET 方法定向获取请求的资源。还需要做 GET 操作才可以获取到用户请求的信息

304 Not Modified 表示客户端发送附带条件的请求，服务器允许请求访问资源，返回的资源未满足请求的条件，用于页面未修改

400 Bad Request 表示请求报文中存在语法错误，服务器无法处理请求

401 Unauthorized 表示请求需要通过 HTTP 认证的认证信息，若之前已进行一次请求则表示用户认证失败

403 Forbidden 表示对请求资源的访问被服务器拒绝。如访问权限，未授权的发送源

404 Not Found 表示服务器无法找到请求的资源

500 Internal Server Error 表示服务器本身发生错误

503 Server Unavailable 表示服务器暂时处于超负载或正在进行停机维护，现在无法处理请求

504 Gateway Timeout 表示请求服务器无响应

### HTTPS

为了解决让 HTTP 协议通信加密、内容加密，使用 HTTPS。HTTP 先和 SSL，再由 SSL 和 TCP 通信。

服务器认证证书，客户端发送请求时会用证书的公开密钥进行加密，服务器接收该报文并用证书的私钥进行解密。

## 面试问题
- post 和 get 的区别        
有 3 点。
1. get 通过 url 后面带请求参数，用来查询数据；post 是通过请求报文的实体部分参数传递，进行更新数据；
2. get 请求 url 后缀带的参数长度受限于浏览器规定的请求地址长度；post 通过实体传递，不受限请求参数的长度
3. get 的参数会经由 Referer 泄漏，也会显示在访问日志中；post 则不会显示在这两处地方，便于传递敏感数据

- cookie 和 session 的区别      
有 3 点。
1. cookie 数据存放在客户的浏览器（客户端）上，session数据放在服务器上，但是服务端的session 的实现对客户端的cookie有依赖关系的；
2. 安全性：cookie 不是很安全，别人可以分析存放在本地的COOKIE并进行COOKIE欺骗，考虑到安全应当使用 session；
3. 性能：session 会在一定时间内保存在服务器上。当访问增多，会比较占用你服务器的性能。